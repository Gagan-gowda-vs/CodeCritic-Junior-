<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ problem.title }} - CodeCritic Junior</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" rel="stylesheet">
    <style>
        .problem-description {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .code-editor {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .CodeMirror {
            height: 400px;
            font-size: 14px;
        }
        .test-case {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .test-case.passed {
            border-left: 4px solid #28a745;
        }
        .test-case.failed {
            border-left: 4px solid #dc3545;
        }
        .test-case.error {
            border-left: 4px solid #ffc107;
        }
        .difficulty {
            font-weight: bold;
        }
        .difficulty.easy { color: #28a745; }
        .difficulty.medium { color: #ffc107; }
        .difficulty.hard { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container py-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('competitive_coding') }}">Problems</a></li>
                <li class="breadcrumb-item active">{{ problem.title }}</li>
            </ol>
        </nav>

        <div class="row">
            <div class="col-md-8">
                <div class="problem-description">
                    <h2>{{ problem.title }} <span class="difficulty {{ problem.difficulty.lower() }}">{{ problem.difficulty }}</span></h2>
                    <p>{{ problem.description }}</p>
                    
                    <h4>Input Format</h4>
                    <p>{{ problem.input_format }}</p>
                    
                    <h4>Output Format</h4>
                    <p>{{ problem.output_format }}</p>
                    
                    <h4>Example</h4>
                    <div class="test-case">
                        <p><strong>Input:</strong> {{ problem.example.input }}</p>
                        <p><strong>Output:</strong> {{ problem.example.output }}</p>
                        <p><strong>Explanation:</strong> {{ problem.example.explanation }}</p>
                    </div>
                </div>

                <div class="code-editor">
                    <div class="mb-3">
                        <label for="language" class="form-label">Language</label>
                        <select class="form-select" id="language">
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                            <option value="cpp">C++</option>
                            <option value="javascript">JavaScript</option>
                        </select>
                    </div>
                    <textarea id="code"></textarea>
                </div>

                <div class="d-flex gap-2 mb-3">
                    <button class="btn btn-primary" onclick="runCode()">Run</button>
                    <button class="btn btn-success" onclick="submitSolution()">Submit</button>
                </div>

                <div id="results" class="mt-4"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script>
        let editor;
        const languageModes = {
            'python': 'python',
            'java': 'text/x-java',
            'cpp': 'text/x-c++src',
            'javascript': 'javascript'
        };

        // Store templates in a JavaScript object
        const templates = {
            python: `{{ problem.templates.python | safe }}`,
            java: `{{ problem.templates.java | safe }}`,
            cpp: `{{ problem.templates.cpp | safe }}`,
            javascript: `{{ problem.templates.javascript | safe }}`
        };

        function initEditor() {
            const language = document.getElementById('language').value;
            const mode = languageModes[language];
            
            if (editor) {
                editor.toTextArea();
            }
            
            editor = CodeMirror.fromTextArea(document.getElementById('code'), {
                mode: mode,
                theme: 'monokai',
                lineNumbers: true,
                indentUnit: 4,
                smartIndent: true,
                indentWithTabs: false,
                lineWrapping: true,
                matchBrackets: true,
                autoCloseBrackets: true
            });

            // Set template code
            editor.setValue(templates[language]);
        }

        document.getElementById('language').addEventListener('change', initEditor);
        initEditor();

        function runCode() {
            const code = editor.getValue();
            const language = document.getElementById('language').value;
            
            fetch('/submit-solution', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    category: '{{ category }}',
                    problem_id: '{{ problem_id }}',
                    code: code,
                    language: language
                })
            })
            .then(response => response.json())
            .then(data => {
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';
                
                if (data.error) {
                    resultsDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                    return;
                }
                
                const results = data.results || [];
                results.forEach((result, index) => {
                    const testCaseDiv = document.createElement('div');
                    testCaseDiv.className = `test-case ${result.passed ? 'passed' : 'failed'}`;
                    
                    let content = `
                        <h5>Test Case ${index + 1}</h5>
                        <p><strong>Input:</strong> ${JSON.stringify(result.input)}</p>
                        <p><strong>Expected:</strong> ${JSON.stringify(result.expected)}</p>
                        <p><strong>Actual:</strong> ${JSON.stringify(result.actual)}</p>
                    `;
                    
                    if (result.error) {
                        testCaseDiv.className = 'test-case error';
                        content += `<p><strong>Error:</strong> ${result.error}</p>`;
                    } else {
                        content += `<p><strong>Status:</strong> ${result.passed ? 'Passed' : 'Failed'}</p>`;
                    }
                    
                    testCaseDiv.innerHTML = content;
                    resultsDiv.appendChild(testCaseDiv);
                });
                
                if (data.success) {
                    resultsDiv.innerHTML += `<div class="alert alert-success mt-3">${data.message}</div>`;
                } else {
                    resultsDiv.innerHTML += `<div class="alert alert-danger mt-3">${data.message}</div>`;
                }
            })
            .catch(error => {
                document.getElementById('results').innerHTML = `
                    <div class="alert alert-danger">
                        Error: ${error.message}
                    </div>
                `;
            });
        }

        function submitSolution() {
            runCode(); // For now, just run the code
        }
    </script>
</body>
</html> 